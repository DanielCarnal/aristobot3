#!/bin/bash
#
# Hook Pre-Commit Aristobot3
# Rappelle de rÃ©gÃ©nÃ©rer CODEBASE_MAP.md si architecture modifiÃ©e
#
# Installation:
#   chmod +x .git-hooks/pre-commit
#   cp .git-hooks/pre-commit .git/hooks/pre-commit
#

echo ""
echo "ğŸ” VÃ©rification pre-commit Aristobot3..."

# VÃ©rifier si des fichiers architecture ont changÃ©
if git diff --cached --name-only | grep -qE "backend/apps/|frontend/src/views/|frontend/src/components/"; then
    echo ""
    echo "âš ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "âš ï¸  RAPPEL: Fichiers architecture modifiÃ©s dÃ©tectÃ©s !"
    echo "âš ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "   Fichiers modifiÃ©s dans:"
    git diff --cached --name-only | grep -E "backend/apps/|frontend/src/views/|frontend/src/components/" | sed 's/^/     - /'
    echo ""
    echo "   ğŸ“š Avez-vous rÃ©gÃ©nÃ©rÃ© CODEBASE_MAP.md avec /cartographer ?"
    echo "   ğŸ“‹ Voir DEVELOPMENT_RULES.md RÃˆGLE #6 pour dÃ©tails"
    echo ""
    echo "   Continuer le commit ? (y/n)"
    read -r response

    if [[ ! "$response" =~ ^[Yy]$ ]]; then
        echo ""
        echo "âŒ Commit annulÃ© - RÃ©gÃ©nÃ©rez CODEBASE_MAP.md puis re-commitez"
        echo ""
        exit 1
    fi

    echo ""
    echo "âœ… Commit autorisÃ© - Assurez-vous que CODEBASE_MAP.md est Ã  jour !"
    echo ""
fi

# VÃ©rifier si DEVELOPMENT_RULES.md est dans le commit (indication nouvelle rÃ¨gle)
if git diff --cached --name-only | grep -q "DEVELOPMENT_RULES.md"; then
    echo ""
    echo "ğŸ“ DEVELOPMENT_RULES.md modifiÃ© - Nouvelle rÃ¨gle ajoutÃ©e ?"
    echo "   N'oubliez pas d'informer l'Ã©quipe des nouvelles contraintes !"
    echo ""
fi

echo "âœ… Pre-commit check terminÃ©"
echo ""

exit 0
